"use strict";var git_client_id="2133bdf4fcf96f2bb227",git_client_secret="45cb23a-390ce0-8c632ca-e2a875416-464b6af769e",git_ls_key="git_access_token",git_redirect_uri="https://imgfo.com",git_ttl=288e5;function parse_query_string(e){for(var t=e.replace("?","").split("&"),n={},i=0;i<t.length;i++){var o=t[i].split("="),c=decodeURIComponent(o[0]),l=decodeURIComponent(o[1]);void 0===n[c]?n[c]=decodeURIComponent(l):"string"==typeof n[c]?(o=[n[c],decodeURIComponent(l)],n[c]=o):n[c].push(decodeURIComponent(l))}return n}function setWithExpiry(e,t,n){n={value:t,expiry:(new Date).getTime()+n};localStorage.setItem(e,JSON.stringify(n))}function getWithExpiry(e){var t=localStorage.getItem(e);if(!t)return null;t=JSON.parse(t);return(new Date).getTime()>t.expiry?(localStorage.removeItem(e),null):t.value}function gitLogin(){return location.href="https://github.com/login/oauth/authorize?client_id="+git_client_id+"&scope=gist&redirect_uri="+git_redirect_uri}function gitLogout(){localStorage.removeItem(git_ls_key),checkGitAccess()}function gitAccessToken(e,n){ajax({headers:{Accept:"application/json"}}).post("https://imgfo-gist.herokuapp.com/https://github.com/login/oauth/access_token?client_id="+git_client_id+"&client_secret="+git_client_secret.replace(/-/g,"")+"&code="+e,{}).then(function(e,t){200===t.status&&n&&"function"==typeof n&&(e.error?n(e.error,null):n(null,e.access_token))}).catch(function(e,t){console.log(t.responseText),n&&"function"==typeof n&&n("Failed to get Git Access Token!",null)})}function checkGitAccess(){var e;null===getWithExpiry(git_ls_key)?void 0===(e=parse_query_string(window.location.search).code)||e.length<1?(document.getElementById("git-login").style.display="inline",document.getElementById("git-logout").style.display="none",document.getElementById("generate").style.display="none"):gitAccessToken(e,function(e,t){e?(localStorage.removeItem(git_ls_key),window.history.replaceState({},document.title,"/"),document.getElementById("git-login").style.display="inline",document.getElementById("git-logout").style.display="none",document.getElementById("generate").style.display="none"):(setWithExpiry(git_ls_key,t,git_ttl),window.history.replaceState({},document.title,"/"),document.getElementById("git-login").style.display="none",document.getElementById("git-logout").style.display="inline",document.getElementById("generate").style.display="inline")}):(document.getElementById("git-login").style.display="none",document.getElementById("git-logout").style.display="inline",document.getElementById("generate").style.display="inline")}function createGist(n,e,i){ajax({headers:{"Content-Type":"application/json",Accept:"application/vnd.github.v3+json",Authorization:"token "+getWithExpiry(git_ls_key)}}).post("https://api.github.com/gists",e).then(function(e,t){201===t.status?i&&"function"==typeof i&&i(null,e.files[n].raw_url.replace("gist.githubusercontent.com","gistcdn.githack.com")):i&&"function"==typeof i&&i(e.message,null)}).catch(function(e,t){checkGitAccess(),i&&"function"==typeof i&&i(e.message,null),console.log(t.responseText)})}checkGitAccess();