"use strict";var git_client_id="00c20f97853bedd9c033",git_client_secret="7cfff52023ef207a1b58623757182cbb0806b3c6",git_ls_key="git_access_token",git_redirect_uri="https://imgfo.com";function parse_query_string(e){for(var t=e.replace("?","").split("&"),n={},i=0;i<t.length;i++){var o,c=t[i].split("="),s=decodeURIComponent(c[0]),l=decodeURIComponent(c[1]);void 0===n[s]?n[s]=decodeURIComponent(l):"string"==typeof n[s]?(o=[n[s],decodeURIComponent(l)],n[s]=o):n[s].push(decodeURIComponent(l))}return n}function setWithExpiry(e,t,n){var i={value:t,expiry:(new Date).getTime()+n};localStorage.setItem(e,JSON.stringify(i))}function getWithExpiry(e){var t=localStorage.getItem(e);if(!t)return null;var n=JSON.parse(t);return(new Date).getTime()>n.expiry?(localStorage.removeItem(e),null):n.value}function gitLogin(e){return location.href="https://github.com/login/oauth/authorize?client_id="+git_client_id+"&scope=gist&redirect_uri="+git_redirect_uri}function gitAccessToken(e,n){ajax({headers:{Accept:"application/json"}}).post("https://cors-anywhere.herokuapp.com/https://github.com/login/oauth/access_token?client_id="+git_client_id+"&client_secret="+git_client_secret+"&code="+e,{}).then(function(e,t){200===t.status&&n&&"function"==typeof n&&(e.error?n(e.error,null):n(null,e.access_token))}).catch(function(e,t){console.log(t.responseText),n&&"function"==typeof n&&n("Failed to get Git Access Token!",null)})}function checkGitAccess(){var e;null===getWithExpiry(git_ls_key)?void 0===(e=parse_query_string(window.location.search).code)||e.length<1?(document.getElementById("git-login").style.display="inline",document.getElementById("generate").style.display="none"):gitAccessToken(e,function(e,t){e?(localStorage.removeItem(git_ls_key),document.getElementById("git-login").style.display="inline",document.getElementById("generate").style.display="none"):(setWithExpiry(git_ls_key,t,3600),document.getElementById("git-login").style.display="none",document.getElementById("generate").style.display="inline")}):(document.getElementById("git-login").style.display="none",document.getElementById("generate").style.display="inline")}function createGist(n,e,i){ajax({headers:{"Content-Type":"application/json",Accept:"application/vnd.github.v3+json",Authorization:"token "+getWithExpiry(git_ls_key)}}).post("https://api.github.com/gists",e).then(function(e,t){201===t.status?i&&"function"==typeof i&&i(null,e.files[n].raw_url.replace("gist.githubusercontent.com","gistcdn.githack.com")):i&&"function"==typeof i&&i(e.message,null)}).catch(function(e,t){checkGitAccess(),i&&"function"==typeof i&&i(e.message,null),console.log(t.responseText)})}checkGitAccess();